<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ZEBROL</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body class="bg-black text-white">
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect } = React;

const firebaseConfig = {
  apiKey: "AIzaSyBAH2rBIR5ibvde0VMVF38QyM4L2s8IqIQ",
  authDomain: "zebrol.firebaseapp.com",
  projectId: "zebrol",
  appId: "1:846397475446:web:1b38ce35dcae4e1754ed57"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

function App() {
  const [user, setUser] = useState(null);
  const [email, setEmail] = useState("");
  const [password, setPassword] = useState("");

  const [items, setItems] = useState([]);
  const [selected, setSelected] = useState(null);

  const [showForm, setShowForm] = useState(false);
  const [editingId, setEditingId] = useState(null);

  const [searchOpen, setSearchOpen] = useState(false);
  const [search, setSearch] = useState("");

  const emptyForm = {
    image: "",
    name: "",
    vulgo: "",
    faction: "",
    cpf: "",
    birth: "",
    mother: "",
    address: "",
    description: ""
  };

  const [form, setForm] = useState(emptyForm);

  useEffect(() => auth.onAuthStateChanged(setUser), []);

  useEffect(() => {
    if (!user) return;
    return db
      .collection("users")
      .doc(user.uid)
      .collection("items")
      .onSnapshot(snapshot => {
        const data = snapshot.docs.map(doc => ({
          id: doc.id,
          ...doc.data()
        }));
        setItems(data);
      });
  }, [user]);

  const login = async () => {
    try {
      await auth.signInWithEmailAndPassword(email, password);
    } catch {
      alert("Erro ao entrar");
    }
  };

  const logout = () => auth.signOut();

  const handleChange = e => {
    const { name, value, files } = e.target;
    if (files && files[0]) {
      const reader = new FileReader();
      reader.onload = () => setForm(prev => ({ ...prev, [name]: reader.result }));
      reader.readAsDataURL(files[0]);
    } else {
      setForm(prev => ({ ...prev, [name]: value }));
    }
  };

  const saveItem = async () => {
    try {
      const ref = db.collection("users").doc(user.uid).collection("items");
      if (editingId) {
        await ref.doc(editingId).update(form);
      } else {
        await ref.add(form);
      }
      setForm(emptyForm);
      setEditingId(null);
      setShowForm(false);
    } catch (e) {
      alert("Erro ao salvar");
      console.error(e);
    }
  };

  const filteredItems = items
    .filter(i => {
      const t = search.toLowerCase();
      return (
        i.name?.toLowerCase().includes(t) ||
        i.vulgo?.toLowerCase().includes(t) ||
        i.faction?.toLowerCase().includes(t)
      );
    })
    .sort((a,b)=>a.name.localeCompare(b.name,"pt-BR",{sensitivity:"base"}));

  if (!user) {
    return (
      <div className="min-h-screen flex flex-col items-center justify-center gap-4">
        <h1 className="text-3xl font-bold">ZEBROL</h1>
        <input className="bg-gray-800 p-2 rounded w-64" placeholder="Email" onChange={e=>setEmail(e.target.value)} />
        <input type="password" className="bg-gray-800 p-2 rounded w-64" placeholder="Senha" onChange={e=>setPassword(e.target.value)} />
        <button onClick={login} className="bg-blue-600 px-4 py-2 rounded">Entrar</button>
      </div>
    );
  }

  return (
    <div className="min-h-screen p-6 space-y-6">
      <h1 className="text-3xl font-bold text-center">ZEBROL</h1>

      {searchOpen && (
        <input
          className="w-full max-w-md mx-auto block bg-gray-900 p-3 rounded"
          placeholder="Pesquisar nome, vulgo ou fac√ß√£o"
          value={search}
          onChange={e=>setSearch(e.target.value)}
        />
      )}

      <div className="grid grid-cols-2 gap-4 max-w-md mx-auto">
        {filteredItems.map(item => (
          <div
            key={item.id}
            onClick={()=>setSelected(item)}
            className="bg-gray-900 p-4 rounded cursor-pointer"
          >
            <div className="h-32 bg-gray-700 rounded mb-2 overflow-hidden">
              {item.image && <img src={item.image} className="w-full h-full object-cover" />}
            </div>
            <p className="text-center font-semibold">{item.name}</p>
            <p className="text-center text-sm text-gray-400">{item.vulgo}</p>
          </div>
        ))}
      </div>

      {selected && (
        <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4">
          <div className="relative bg-gray-900 p-6 rounded max-w-sm w-full">
            <button onClick={()=>setSelected(null)} className="text-red-400 text-sm absolute top-2 right-2">Fechar</button>

            {selected.image && (
              <img src={selected.image} className="w-full object-contain rounded mb-3" />
            )}

            <p><b>Nome:</b> {selected.name}</p>
            <p><b>Vulgo:</b> {selected.vulgo}</p>
            <p><b>Fac√ß√£o:</b> {selected.faction}</p>
            <p><b>CPF:</b> {selected.cpf}</p>
            <p><b>Nasc:</b> {selected.birth}</p>
            <p><b>M√£e:</b> {selected.mother}</p>
            <p><b>Endere√ßo:</b> {selected.address}</p>
            <p><b>Descri√ß√£o:</b> {selected.description}</p>

            <button
              onClick={()=>{
                setForm(selected);
                setEditingId(selected.id);
                setShowForm(true);
                setSelected(null);
              }}
              className="absolute bottom-4 left-4 text-blue-500 text-2xl"
            >‚úèÔ∏è</button>
          </div>
        </div>
      )}

      <button onClick={()=>setSearchOpen(!searchOpen)} className="fixed bottom-6 left-6 bg-gray-800 w-14 h-14 rounded-full flex items-center justify-center text-2xl">üîç</button>

      <button
        onClick={()=>{
          setForm(emptyForm);
          setEditingId(null);
          setShowForm(true);
        }}
        className="fixed bottom-6 right-6 bg-blue-600 w-14 h-14 rounded-full flex items-center justify-center text-3xl"
      >+</button>

      <button onClick={logout} className="fixed top-4 right-4 text-red-400 text-sm">Sair</button>

      {showForm && (
        <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4">
          <div className="bg-gray-900 p-4 rounded max-w-sm w-full space-y-2">
            <input type="file" name="image" onChange={handleChange} />
            {Object.keys(emptyForm).filter(k=>k!=="image").map(k=>(
              k==="description"
                ? <textarea key={k} name={k} placeholder={k} className="w-full bg-gray-800 p-2 rounded" value={form[k]} onChange={handleChange}/>
                : <input key={k} name={k} placeholder={k} className="w-full bg-gray-800 p-2 rounded" value={form[k]} onChange={handleChange}/>
            ))}
            <button onClick={saveItem} className="w-full bg-blue-600 p-2 rounded">Salvar</button>
            <button onClick={()=>setShowForm(false)} className="w-full bg-gray-700 p-2 rounded">Cancelar</button>
          </div>
        </div>
      )}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
