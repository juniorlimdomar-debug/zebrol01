<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ZEBROL</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <!-- Babel -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>

<body class="bg-black text-white">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;
    const PIN_CORRETO = "1234";

    function App() {
      const [auth, setAuth] = useState(() => localStorage.getItem("zebrol_auth") === "true");
      const [pin, setPin] = useState("");

      const [items, setItems] = useState(() => {
        const saved = localStorage.getItem("zebrol_items");
        return saved ? JSON.parse(saved) : [];
      });

      const [selected, setSelected] = useState(null);
      const [showForm, setShowForm] = useState(false);
      const [editId, setEditId] = useState(null);
      const [confirmDelete, setConfirmDelete] = useState(null);

      const [searchOpen, setSearchOpen] = useState(false);
      const [search, setSearch] = useState("");

      const emptyForm = {
        id: null,
        image: "",
        name: "",
        vulgo: "",
        faction: "",
        cpf: "",
        birth: "",
        mother: "",
        address: "",
        description: ""
      };

      const [form, setForm] = useState(emptyForm);

      useEffect(() => {
        localStorage.setItem("zebrol_items", JSON.stringify(items));
      }, [items]);

      /* LOGIN */
      const login = () => {
        if (pin === PIN_CORRETO) {
          localStorage.setItem("zebrol_auth", "true");
          setAuth(true);
        } else {
          alert("Senha incorreta");
          setPin("");
        }
      };

      /* INPUTS */
      const handleChange = (e) => {
        const { name, value, files } = e.target;
        if (files && files[0]) {
          const reader = new FileReader();
          reader.onload = () => setForm(prev => ({ ...prev, [name]: reader.result }));
          reader.readAsDataURL(files[0]);
        } else {
          setForm(prev => ({ ...prev, [name]: value }));
        }
      };

      /* SALVAR */
      const saveItem = () => {
        if (editId) {
          setItems(prev =>
            prev.map(item =>
              item.id === editId ? { ...form, id: editId } : item
            )
          );
        } else {
          setItems(prev => [...prev, { ...form, id: crypto.randomUUID() }]);
        }
        setForm(emptyForm);
        setEditId(null);
        setShowForm(false);
      };

      /* FILTRO + ORDENA√á√ÉO */
      const filteredItems = items
        .filter(item => {
          const t = search.toLowerCase();
          return (
            item.name.toLowerCase().includes(t) ||
            item.vulgo.toLowerCase().includes(t) ||
            item.faction.toLowerCase().includes(t)
          );
        })
        .sort((a, b) =>
          a.name.localeCompare(b.name, "pt-BR", { sensitivity: "base" })
        );

      /* LOGIN UI */
      if (!auth) {
        return (
          <div className="min-h-screen flex flex-col items-center justify-center space-y-6">
            <h1 className="text-3xl font-bold">ZEBROL</h1>

            <input
              type="password"
              value={pin}
              readOnly
              className="bg-gray-900 p-3 rounded text-center text-2xl tracking-widest w-40"
            />

            <div className="grid grid-cols-3 gap-4">
              {[1,2,3,4,5,6,7,8,9,0].map(n => (
                <button
                  key={n}
                  onClick={() => pin.length < 6 && setPin(pin + n)}
                  className="bg-gray-800 w-16 h-16 rounded text-xl"
                >
                  {n}
                </button>
              ))}
            </div>

            <div className="flex gap-4">
              <button onClick={() => setPin("")} className="bg-gray-700 px-4 py-2 rounded">Limpar</button>
              <button onClick={login} className="bg-blue-600 px-4 py-2 rounded">Entrar</button>
            </div>
          </div>
        );
      }

      /* APP */
      return (
        <div className="min-h-screen p-6 space-y-6">
          <h1 className="text-3xl font-bold text-center">ZEBROL</h1>

          {searchOpen && (
            <input
              className="w-full max-w-md mx-auto block bg-gray-900 p-3 rounded"
              placeholder="Pesquisar nome, vulgo ou fac√ß√£o"
              value={search}
              onChange={e => setSearch(e.target.value)}
            />
          )}

          <div className="grid grid-cols-2 gap-4 max-w-md mx-auto">
            {filteredItems.map(item => (
              <div
                key={item.id}
                onClick={() => setSelected(item)}
                className="bg-gray-900 p-4 rounded cursor-pointer hover:bg-gray-800"
              >
                <div className="h-32 bg-gray-700 rounded mb-2 overflow-hidden">
                  {item.image && <img src={item.image} className="w-full h-full object-cover" />}
                </div>
                <p className="text-center font-semibold">{item.name}</p>
              </div>
            ))}
          </div>

          {/* BOT√ïES */}
          <button
            onClick={() => setSearchOpen(!searchOpen)}
            className="fixed bottom-6 left-6 bg-gray-800 w-14 h-14 rounded-full text-2xl"
          >üîç</button>

          <button
            onClick={() => {
              setForm(emptyForm);
              setEditId(null);
              setShowForm(true);
            }}
            className="fixed bottom-6 right-6 bg-blue-600 w-14 h-14 rounded-full text-3xl"
          >+</button>

          {/* MODAL DETALHES */}
          {selected && (
            <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-40">
              <div className="relative bg-gray-900 p-6 rounded-2xl w-full max-w-sm space-y-2">
                <button onClick={() => setSelected(null)} className="text-red-400 text-sm absolute top-2 right-2">Fechar</button>

                {selected.image && (
                  <img src={selected.image} className="w-full h-auto max-h-72 object-contain rounded mb-2"/>
                )}

                <p><b>Nome:</b> {selected.name}</p>
                <p><b>Vulgo:</b> {selected.vulgo}</p>
                <p><b>Fac√ß√£o:</b> {selected.faction}</p>
                <p><b>CPF:</b> {selected.cpf}</p>
                <p><b>Nasc.:</b> {selected.birth}</p>
                <p><b>M√£e:</b> {selected.mother}</p>
                <p><b>Endere√ßo:</b> {selected.address}</p>
                <p><b>Descri√ß√£o:</b> {selected.description}</p>

                <button
                  onClick={() => {
                    setForm(selected);
                    setEditId(selected.id);
                    setShowForm(true);
                  }}
                  className="absolute bottom-4 left-4 text-blue-500 text-2xl"
                >‚úèÔ∏è</button>

                <button
                  onClick={() => setConfirmDelete(selected.id)}
                  className="absolute bottom-4 right-4 text-red-500 text-2xl"
                >üóëÔ∏è</button>
              </div>
            </div>
          )}

          {/* CONFIRMAR EXCLUS√ÉO */}
          {confirmDelete && (
            <div className="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50">
              <div className="bg-gray-900 p-6 rounded space-y-4 text-center">
                <p>Tem certeza que deseja excluir?</p>
                <div className="flex gap-4">
                  <button
                    onClick={() => {
                      setItems(prev => prev.filter(i => i.id !== confirmDelete));
                      setConfirmDelete(null);
                      setSelected(null);
                    }}
                    className="bg-red-600 px-4 py-2 rounded"
                  >Sim</button>
                  <button
                    onClick={() => setConfirmDelete(null)}
                    className="bg-gray-700 px-4 py-2 rounded"
                  >N√£o</button>
                </div>
              </div>
            </div>
          )}

          {/* FORM */}
          {showForm && (
            <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-40">
              <div className="bg-gray-900 p-6 rounded w-full max-w-sm space-y-3">
                <input type="file" name="image" accept="image/*" onChange={handleChange} />
                <input className="w-full bg-gray-800 p-2 rounded" name="name" placeholder="Nome" value={form.name} onChange={handleChange}/>
                <input className="w-full bg-gray-800 p-2 rounded" name="vulgo" placeholder="Vulgo" value={form.vulgo} onChange={handleChange}/>
                <input className="w-full bg-gray-800 p-2 rounded" name="faction" placeholder="Fac√ß√£o" value={form.faction} onChange={handleChange}/>
                <input className="w-full bg-gray-800 p-2 rounded" name="cpf" placeholder="CPF" value={form.cpf} onChange={handleChange}/>
                <input className="w-full bg-gray-800 p-2 rounded" type="date" name="birth" value={form.birth} onChange={handleChange}/>
                <input className="w-full bg-gray-800 p-2 rounded" name="mother" placeholder="Nome da m√£e" value={form.mother} onChange={handleChange}/>
                <input className="w-full bg-gray-800 p-2 rounded" name="address" placeholder="Endere√ßo" value={form.address} onChange={handleChange}/>
                <textarea className="w-full bg-gray-800 p-2 rounded" name="description" placeholder="Descri√ß√£o" value={form.description} onChange={handleChange}/>

                <button onClick={saveItem} className="w-full bg-blue-600 p-2 rounded">Salvar</button>
                <button onClick={() => setShowForm(false)} className="w-full bg-gray-700 p-2 rounded">Cancelar</button>
              </div>
            </div>
          )}
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App />);
  </script>
</body>
</html>
